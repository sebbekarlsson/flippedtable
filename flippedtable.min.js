var FlippedTableRow=function(element){this.initialize=function(element){this.element=element};this.initialize(element);this.getValue=function(key){var tds=this.element.querySelectorAll('td');for(var i=0;i<tds.length;i++)if(tds[i].getAttribute('key')==key)return tds[i].innerHTML};this.setValue=function(key,value){var tds=this.element.querySelectorAll('td');for(var i=0;i<tds.length;i++)if(tds[i].getAttribute('key')==key)tds[i].innerHTML=value}},FlippedTable=function(element){this.initialize=function(element){this.element=element;this.table=document.createElement('table');this.head=document.createElement('thead');this.body=document.createElement('tbody');this.table.appendChild(this.head);this.table.appendChild(this.body);this.element.setAttribute('version','0');this.element.appendChild(this.table)};this.initialize(element);this.setKeys=function(keyarr){this.head.innerHTML='';var tr=document.createElement('tr');for(var i=0;i<keyarr.length;i++){var k=keyarr[i],th=document.createElement('th');th.innerHTML=k;tr.appendChild(th)};this.head.appendChild(tr);return tr};this.addRecord=function(record){var tr=document.createElement('tr'),ths=this.head.querySelectorAll('th');for(var ii=0;ii<ths.length;ii++)for(var key in record)if(key==ths[ii].innerHTML){var td=document.createElement('td');td.innerHTML=record[key];td.setAttribute('key',ths[ii].innerHTML);tr.appendChild(td)};if(tr.childNodes.length==0)return undefined;this.body.appendChild(tr);return tr};this.getRecords=function(by,value){var row_arr=[],rows=this.body.querySelectorAll('tr');for(var i=0;i<rows.length;i++){var tds=rows[i].querySelectorAll('td');for(var ii=0;ii<tds.length;ii++)if(tds[ii].getAttribute('key')==by)if(tds[ii].innerHTML==value)row_arr.push(new FlippedTableRow(rows[i]))};return row_arr};this.clean=function(){this.head.innerHTML='';this.body.innerHTML='';return this};this.synchronize=function(url){var xmlHttp=new XMLHttpRequest();xmlHttp.open("GET",url,false);xmlHttp.send(null);var response_text=xmlHttp.responseText,j=JSON.parse(response_text),version=j['version'],current_version=this.element.getAttribute('version');if(current_version!=version){this.clean();this.setKeys(j['keys']);var rows=j['rows'];for(var i=0;i<rows.length;i++){var row=rows[i];this.addRecord(row)};return true};return false}}
